{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyNgljZzpnZJ5EekM0SIgCng"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"accelerator":"GPU","gpuClass":"standard","widgets":{"application/vnd.jupyter.widget-state+json":{"1ae5c5c94933410792552733887794ba":{"model_module":"@jupyter-widgets/controls","model_name":"VBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"VBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"VBoxView","box_style":"","children":["IPY_MODEL_844aece9c7c4489c9304666c898f0897","IPY_MODEL_73cbb95c2c864d0b9dc230f30d0ff835","IPY_MODEL_15950fbd3408405298cf597d9ca78738","IPY_MODEL_be8de62173ab4a66af9c640e9628fc5e","IPY_MODEL_a7bc1100e4954942b668254ca72a9f25"],"layout":"IPY_MODEL_cc3b800228c443ff886bfa6bf151b378"}},"844aece9c7c4489c9304666c898f0897":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_99ae7ba16b064427b0a9b77f07015ce8","placeholder":"​","style":"IPY_MODEL_a44ba3eecc6142c0895b49c0933e9468","value":"<center> <img\nsrc=https://huggingface.co/front/assets/huggingface_logo-noborder.svg\nalt='Hugging Face'> <br> Copy a token from <a\nhref=\"https://huggingface.co/settings/tokens\" target=\"_blank\">your Hugging Face\ntokens page</a> and paste it below. <br> Immediately click login after copying\nyour token or it might be stored in plain text in this notebook file. </center>"}},"73cbb95c2c864d0b9dc230f30d0ff835":{"model_module":"@jupyter-widgets/controls","model_name":"PasswordModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"PasswordModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"PasswordView","continuous_update":true,"description":"Token:","description_tooltip":null,"disabled":false,"layout":"IPY_MODEL_3cb3f4db4dce4b25af0d10d375953ab4","placeholder":"​","style":"IPY_MODEL_d146a6a5cbe04963bb2e38ad6858633f","value":""}},"15950fbd3408405298cf597d9ca78738":{"model_module":"@jupyter-widgets/controls","model_name":"CheckboxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"CheckboxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"CheckboxView","description":"Add token as git credential?","description_tooltip":null,"disabled":false,"indent":true,"layout":"IPY_MODEL_8cc849d603c24c20979af513c9e249e2","style":"IPY_MODEL_1729df54c9424b639260e117e804ebff","value":true}},"be8de62173ab4a66af9c640e9628fc5e":{"model_module":"@jupyter-widgets/controls","model_name":"ButtonModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ButtonModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ButtonView","button_style":"","description":"Login","disabled":false,"icon":"","layout":"IPY_MODEL_94460d7df63f4027abb8e1af2e1298df","style":"IPY_MODEL_2445d888a7644987b560dd65fd72fa6d","tooltip":""}},"a7bc1100e4954942b668254ca72a9f25":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_95dd0ad2bacf44c4a36dc78112d7daa0","placeholder":"​","style":"IPY_MODEL_8c14457e23a44606be3cba5ef9fbef7a","value":"\n<b>Pro Tip:</b> If you don't already have one, you can create a dedicated\n'notebooks' token with 'write' access, that you can then easily reuse for all\nnotebooks. </center>"}},"cc3b800228c443ff886bfa6bf151b378":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":"center","align_self":null,"border":null,"bottom":null,"display":"flex","flex":null,"flex_flow":"column","grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"50%"}},"99ae7ba16b064427b0a9b77f07015ce8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a44ba3eecc6142c0895b49c0933e9468":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"3cb3f4db4dce4b25af0d10d375953ab4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d146a6a5cbe04963bb2e38ad6858633f":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"8cc849d603c24c20979af513c9e249e2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1729df54c9424b639260e117e804ebff":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"94460d7df63f4027abb8e1af2e1298df":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2445d888a7644987b560dd65fd72fa6d":{"model_module":"@jupyter-widgets/controls","model_name":"ButtonStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ButtonStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","button_color":null,"font_weight":""}},"95dd0ad2bacf44c4a36dc78112d7daa0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8c14457e23a44606be3cba5ef9fbef7a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a4a4eddc0764443fb20fd56f5813c268":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_9453a0ceaefd4eceaf8e150d2c5b5723","IPY_MODEL_7f623a0633564335a74ca23e55539e7f","IPY_MODEL_ba8bbc5f01114eb89614bb97df86c79a"],"layout":"IPY_MODEL_20c06d52c26a457391dcdf6197560682"}},"9453a0ceaefd4eceaf8e150d2c5b5723":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_32ceceaf407e42bd9bd1331bad6ecc97","placeholder":"​","style":"IPY_MODEL_441367dadc0340c586826c3027efdf37","value":"100%"}},"7f623a0633564335a74ca23e55539e7f":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_ceb0e70280a548a89aebe6470e4a7f4d","max":3,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9c3778dbdc0e471b8288b261486bc4d6","value":3}},"ba8bbc5f01114eb89614bb97df86c79a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0e2166fc8c53476bb6d1a61209f96cae","placeholder":"​","style":"IPY_MODEL_3d8109ca6c3a40cea04fdce661ace6f4","value":" 3/3 [00:00&lt;00:00, 60.96it/s]"}},"20c06d52c26a457391dcdf6197560682":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"32ceceaf407e42bd9bd1331bad6ecc97":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"441367dadc0340c586826c3027efdf37":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ceb0e70280a548a89aebe6470e4a7f4d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c3778dbdc0e471b8288b261486bc4d6":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0e2166fc8c53476bb6d1a61209f96cae":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3d8109ca6c3a40cea04fdce661ace6f4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","source":["! pip install evaluate"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Dmq4ieHbsNRr","executionInfo":{"status":"ok","timestamp":1672866593301,"user_tz":-210,"elapsed":8790,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"7f3d9637-9e18-4694-e788-c29e585d7321"},"execution_count":95,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: evaluate in /usr/local/lib/python3.8/dist-packages (0.4.0)\n","Requirement already satisfied: dill in /usr/local/lib/python3.8/dist-packages (from evaluate) (0.3.6)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.8/dist-packages (from evaluate) (1.21.6)\n","Requirement already satisfied: multiprocess in /usr/local/lib/python3.8/dist-packages (from evaluate) (0.70.14)\n","Requirement already satisfied: xxhash in /usr/local/lib/python3.8/dist-packages (from evaluate) (3.2.0)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.8/dist-packages (from evaluate) (1.3.5)\n","Requirement already satisfied: fsspec[http]>=2021.05.0 in /usr/local/lib/python3.8/dist-packages (from evaluate) (2022.11.0)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.8/dist-packages (from evaluate) (21.3)\n","Requirement already satisfied: requests>=2.19.0 in /usr/local/lib/python3.8/dist-packages (from evaluate) (2.25.1)\n","Requirement already satisfied: responses<0.19 in /usr/local/lib/python3.8/dist-packages (from evaluate) (0.18.0)\n","Requirement already satisfied: tqdm>=4.62.1 in /usr/local/lib/python3.8/dist-packages (from evaluate) (4.64.1)\n","Requirement already satisfied: datasets>=2.0.0 in /usr/local/lib/python3.8/dist-packages (from evaluate) (2.8.0)\n","Requirement already satisfied: huggingface-hub>=0.7.0 in /usr/local/lib/python3.8/dist-packages (from evaluate) (0.11.1)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.8/dist-packages (from datasets>=2.0.0->evaluate) (6.0)\n","Requirement already satisfied: pyarrow>=6.0.0 in /usr/local/lib/python3.8/dist-packages (from datasets>=2.0.0->evaluate) (9.0.0)\n","Requirement already satisfied: aiohttp in /usr/local/lib/python3.8/dist-packages (from datasets>=2.0.0->evaluate) (3.8.3)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from huggingface-hub>=0.7.0->evaluate) (3.8.2)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.8/dist-packages (from huggingface-hub>=0.7.0->evaluate) (4.4.0)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.8/dist-packages (from packaging->evaluate) (3.0.9)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->evaluate) (4.0.0)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->evaluate) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->evaluate) (2022.12.7)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->evaluate) (1.26.13)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.8/dist-packages (from pandas->evaluate) (2022.7)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.8/dist-packages (from pandas->evaluate) (2.8.2)\n","Requirement already satisfied: charset-normalizer<3.0,>=2.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (2.1.1)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (1.3.1)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (1.8.2)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (22.2.0)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (4.0.2)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (6.0.3)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets>=2.0.0->evaluate) (1.3.3)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.7.3->pandas->evaluate) (1.15.0)\n"]}]},{"cell_type":"code","source":["! pip install hugsvision"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Py8gXzhQikwQ","executionInfo":{"status":"ok","timestamp":1672866598083,"user_tz":-210,"elapsed":4792,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"c745b2ab-03be-4904-cb9f-ff165ebbbb60"},"execution_count":96,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: hugsvision in /usr/local/lib/python3.8/dist-packages (0.75.3)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.8/dist-packages (from hugsvision) (4.64.1)\n","Requirement already satisfied: torchmetrics in /usr/local/lib/python3.8/dist-packages (from hugsvision) (0.11.0)\n","Requirement already satisfied: transformers in /usr/local/lib/python3.8/dist-packages (from hugsvision) (4.25.1)\n","Requirement already satisfied: tabulate in /usr/local/lib/python3.8/dist-packages (from hugsvision) (0.8.10)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.8/dist-packages (from hugsvision) (1.0.2)\n","Requirement already satisfied: timm in /usr/local/lib/python3.8/dist-packages (from hugsvision) (0.6.12)\n","Requirement already satisfied: Pillow in /usr/local/lib/python3.8/dist-packages (from hugsvision) (7.1.2)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from hugsvision) (3.2.2)\n","Requirement already satisfied: pytorch-lightning in /usr/local/lib/python3.8/dist-packages (from hugsvision) (1.8.6)\n","Requirement already satisfied: torch in /usr/local/lib/python3.8/dist-packages (from hugsvision) (1.13.0+cu116)\n","Requirement already satisfied: torchvision in /usr/local/lib/python3.8/dist-packages (from hugsvision) (0.14.0+cu116)\n","Requirement already satisfied: pycocotools in /usr/local/lib/python3.8/dist-packages (from hugsvision) (2.0.6)\n","Requirement already satisfied: opencv-python in /usr/local/lib/python3.8/dist-packages (from hugsvision) (4.6.0.66)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->hugsvision) (2.8.2)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->hugsvision) (1.4.4)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib->hugsvision) (0.11.0)\n","Requirement already satisfied: numpy>=1.11 in /usr/local/lib/python3.8/dist-packages (from matplotlib->hugsvision) (1.21.6)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib->hugsvision) (3.0.9)\n","Requirement already satisfied: typing-extensions>=4.0.0 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning->hugsvision) (4.4.0)\n","Requirement already satisfied: lightning-utilities!=0.4.0,>=0.3.0 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning->hugsvision) (0.5.0)\n","Requirement already satisfied: PyYAML>=5.4 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning->hugsvision) (6.0)\n","Requirement already satisfied: fsspec[http]>2021.06.0 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning->hugsvision) (2022.11.0)\n","Requirement already satisfied: packaging>=17.0 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning->hugsvision) (21.3)\n","Requirement already satisfied: tensorboardX>=2.2 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning->hugsvision) (2.5.1)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.8/dist-packages (from scikit-learn->hugsvision) (3.1.0)\n","Requirement already satisfied: scipy>=1.1.0 in /usr/local/lib/python3.8/dist-packages (from scikit-learn->hugsvision) (1.7.3)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.8/dist-packages (from scikit-learn->hugsvision) (1.2.0)\n","Requirement already satisfied: huggingface-hub in /usr/local/lib/python3.8/dist-packages (from timm->hugsvision) (0.11.1)\n","Requirement already satisfied: requests in /usr/local/lib/python3.8/dist-packages (from torchvision->hugsvision) (2.25.1)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from transformers->hugsvision) (3.8.2)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.8/dist-packages (from transformers->hugsvision) (2022.6.2)\n","Requirement already satisfied: tokenizers!=0.11.3,<0.14,>=0.11.1 in /usr/local/lib/python3.8/dist-packages (from transformers->hugsvision) (0.13.2)\n","Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /usr/local/lib/python3.8/dist-packages (from fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (3.8.3)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.1->matplotlib->hugsvision) (1.15.0)\n","Requirement already satisfied: protobuf<=3.20.1,>=3.8.0 in /usr/local/lib/python3.8/dist-packages (from tensorboardX>=2.2->pytorch-lightning->hugsvision) (3.19.6)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision->hugsvision) (1.26.13)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision->hugsvision) (4.0.0)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision->hugsvision) (2022.12.7)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests->torchvision->hugsvision) (2.10)\n","Requirement already satisfied: charset-normalizer<3.0,>=2.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (2.1.1)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (22.2.0)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (1.3.1)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (1.3.3)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (4.0.2)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (1.8.2)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning->hugsvision) (6.0.3)\n"]}]},{"cell_type":"code","source":["!pip install datasets"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"axf37scUi0iH","executionInfo":{"status":"ok","timestamp":1672866601681,"user_tz":-210,"elapsed":3602,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"3db1f93d-cb07-490e-9435-3446ed390f99"},"execution_count":97,"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: datasets in /usr/local/lib/python3.8/dist-packages (2.8.0)\n","Requirement already satisfied: fsspec[http]>=2021.11.1 in /usr/local/lib/python3.8/dist-packages (from datasets) (2022.11.0)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.8/dist-packages (from datasets) (6.0)\n","Requirement already satisfied: aiohttp in /usr/local/lib/python3.8/dist-packages (from datasets) (3.8.3)\n","Requirement already satisfied: tqdm>=4.62.1 in /usr/local/lib/python3.8/dist-packages (from datasets) (4.64.1)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.8/dist-packages (from datasets) (21.3)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.8/dist-packages (from datasets) (1.21.6)\n","Requirement already satisfied: pandas in /usr/local/lib/python3.8/dist-packages (from datasets) (1.3.5)\n","Requirement already satisfied: pyarrow>=6.0.0 in /usr/local/lib/python3.8/dist-packages (from datasets) (9.0.0)\n","Requirement already satisfied: dill<0.3.7 in /usr/local/lib/python3.8/dist-packages (from datasets) (0.3.6)\n","Requirement already satisfied: responses<0.19 in /usr/local/lib/python3.8/dist-packages (from datasets) (0.18.0)\n","Requirement already satisfied: huggingface-hub<1.0.0,>=0.2.0 in /usr/local/lib/python3.8/dist-packages (from datasets) (0.11.1)\n","Requirement already satisfied: multiprocess in /usr/local/lib/python3.8/dist-packages (from datasets) (0.70.14)\n","Requirement already satisfied: requests>=2.19.0 in /usr/local/lib/python3.8/dist-packages (from datasets) (2.25.1)\n","Requirement already satisfied: xxhash in /usr/local/lib/python3.8/dist-packages (from datasets) (3.2.0)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (1.3.1)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (1.8.2)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (22.2.0)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (6.0.3)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (4.0.2)\n","Requirement already satisfied: charset-normalizer<3.0,>=2.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (2.1.1)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.8/dist-packages (from aiohttp->datasets) (1.3.3)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from huggingface-hub<1.0.0,>=0.2.0->datasets) (3.8.2)\n","Requirement already satisfied: typing-extensions>=3.7.4.3 in /usr/local/lib/python3.8/dist-packages (from huggingface-hub<1.0.0,>=0.2.0->datasets) (4.4.0)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.8/dist-packages (from packaging->datasets) (3.0.9)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->datasets) (2022.12.7)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->datasets) (4.0.0)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->datasets) (2.10)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests>=2.19.0->datasets) (1.26.13)\n","Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.8/dist-packages (from pandas->datasets) (2022.7)\n","Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.8/dist-packages (from pandas->datasets) (2.8.2)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.8/dist-packages (from python-dateutil>=2.7.3->pandas->datasets) (1.15.0)\n"]}]},{"cell_type":"code","source":["from datasets import load_dataset\n","from transformers import AutoImageProcessor, BeitForSemanticSegmentation\n","from transformers import BeitFeatureExtractor\n","import torch\n","from torch import nn\n","from torch.utils.data import DataLoader\n","\n","from transformers import TrainingArguments, Trainer\n","from datasets import load_metric, DatasetDict, Dataset, load_dataset\n","\n","from tqdm.auto import tqdm\n","import matplotlib.pyplot as plt\n","from PIL import Image\n","\n","# import wandb\n","import numpy as np\n","import os\n","from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay, f1_score, accuracy_score"],"metadata":{"id":"eVJqNNImjA2v","executionInfo":{"status":"ok","timestamp":1672866601682,"user_tz":-210,"elapsed":7,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":98,"outputs":[]},{"cell_type":"code","source":["from huggingface_hub import login\n","login()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":303,"referenced_widgets":["1ae5c5c94933410792552733887794ba","844aece9c7c4489c9304666c898f0897","73cbb95c2c864d0b9dc230f30d0ff835","15950fbd3408405298cf597d9ca78738","be8de62173ab4a66af9c640e9628fc5e","a7bc1100e4954942b668254ca72a9f25","cc3b800228c443ff886bfa6bf151b378","99ae7ba16b064427b0a9b77f07015ce8","a44ba3eecc6142c0895b49c0933e9468","3cb3f4db4dce4b25af0d10d375953ab4","d146a6a5cbe04963bb2e38ad6858633f","8cc849d603c24c20979af513c9e249e2","1729df54c9424b639260e117e804ebff","94460d7df63f4027abb8e1af2e1298df","2445d888a7644987b560dd65fd72fa6d","95dd0ad2bacf44c4a36dc78112d7daa0","8c14457e23a44606be3cba5ef9fbef7a"]},"id":"vS9hYk4gt4Ub","executionInfo":{"status":"ok","timestamp":1672866601682,"user_tz":-210,"elapsed":6,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"637abd5f-b2a9-4a83-8693-4c121508532f"},"execution_count":99,"outputs":[{"output_type":"display_data","data":{"text/plain":["VBox(children=(HTML(value='<center> <img\\nsrc=https://huggingface.co/front/assets/huggingface_logo-noborder.sv…"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"1ae5c5c94933410792552733887794ba"}},"metadata":{}}]},{"cell_type":"code","source":["dataset = load_dataset('scene_parse_150',)\n","dataset"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":327,"referenced_widgets":["a4a4eddc0764443fb20fd56f5813c268","9453a0ceaefd4eceaf8e150d2c5b5723","7f623a0633564335a74ca23e55539e7f","ba8bbc5f01114eb89614bb97df86c79a","20c06d52c26a457391dcdf6197560682","32ceceaf407e42bd9bd1331bad6ecc97","441367dadc0340c586826c3027efdf37","ceb0e70280a548a89aebe6470e4a7f4d","9c3778dbdc0e471b8288b261486bc4d6","0e2166fc8c53476bb6d1a61209f96cae","3d8109ca6c3a40cea04fdce661ace6f4"]},"id":"pvSg0OIsi3n3","executionInfo":{"status":"ok","timestamp":1672866606768,"user_tz":-210,"elapsed":5091,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"821f2d3e-f5cf-40d1-c37c-cf7c09674aac"},"execution_count":100,"outputs":[{"output_type":"stream","name":"stderr","text":["WARNING:datasets.builder:No config specified, defaulting to: scene_parse_150/scene_parsing\n","WARNING:datasets.builder:Found cached dataset scene_parse_150 (/root/.cache/huggingface/datasets/scene_parse_150/scene_parsing/1.0.0/d998c54e1b5c5bad12b4d2ec7e1a5f74eee4c153bc1b089a0001677ae9b3fd75)\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/3 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"a4a4eddc0764443fb20fd56f5813c268"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["DatasetDict({\n","    train: Dataset({\n","        features: ['image', 'annotation', 'scene_category'],\n","        num_rows: 20210\n","    })\n","    test: Dataset({\n","        features: ['image', 'annotation', 'scene_category'],\n","        num_rows: 3352\n","    })\n","    validation: Dataset({\n","        features: ['image', 'annotation', 'scene_category'],\n","        num_rows: 2000\n","    })\n","})"]},"metadata":{},"execution_count":100}]},{"cell_type":"code","source":["train_ds = dataset[\"train\"]\n","test_ds = dataset[\"test\"]"],"metadata":{"id":"hPZ_9xrlljnz","executionInfo":{"status":"ok","timestamp":1672866606768,"user_tz":-210,"elapsed":9,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":101,"outputs":[]},{"cell_type":"code","source":["train_ds"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"rqimzOjIhy7H","executionInfo":{"status":"ok","timestamp":1672866606769,"user_tz":-210,"elapsed":9,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"e5ba1f61-9e41-452d-fb33-e770e19e0c4e"},"execution_count":102,"outputs":[{"output_type":"execute_result","data":{"text/plain":["Dataset({\n","    features: ['image', 'annotation', 'scene_category'],\n","    num_rows: 20210\n","})"]},"metadata":{},"execution_count":102}]},{"cell_type":"code","source":["hf_dataset_identifier = \"scene_parse_150\""],"metadata":{"id":"ph_SoSZblxqx","executionInfo":{"status":"ok","timestamp":1672866606769,"user_tz":-210,"elapsed":8,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":103,"outputs":[]},{"cell_type":"code","source":["from torchvision.transforms import ColorJitter\n","from transformers import BeitFeatureExtractor\n","\n","feature_extractor = BeitFeatureExtractor.from_pretrained(\"microsoft/beit-base-finetuned-ade-640-640\", reduce_labels=True, size=(640, 640))\n","jitter = ColorJitter(brightness=0.25, contrast=0.25, saturation=0.25, hue=0.1) \n","\n","def train_transforms(example_batch):\n","    images = [jitter(x) for x in example_batch[\"image\"]]\n","    labels = [x for x in example_batch[\"annotation\"]]\n","    inputs = feature_extractor(images, labels, return_tensors='pt')\n","    return inputs\n","\n","\n","def val_transforms(example_batch):\n","    images = [x for x in example_batch[\"image\"]]\n","    labels = [x for x in example_batch[\"annotation\"]]\n","    inputs = feature_extractor(images, labels, return_tensors='pt')\n","    return inputs"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7sjMmYuVlpkp","executionInfo":{"status":"ok","timestamp":1672866607454,"user_tz":-210,"elapsed":693,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"3b233461-ce0e-4872-a5a3-e558c31705e3"},"execution_count":104,"outputs":[{"output_type":"stream","name":"stderr","text":["loading configuration file preprocessor_config.json from cache at /root/.cache/huggingface/hub/models--microsoft--beit-base-finetuned-ade-640-640/snapshots/a8b6f5ef4acb2ea55d882989deaa02d39401e2b2/preprocessor_config.json\n","{param_name} should be a dictionary on of the following set of keys: {VALID_SIZE_DICT_KEYS}, got {size}. Converted to {size_dict}.\n","{param_name} should be a dictionary on of the following set of keys: {VALID_SIZE_DICT_KEYS}, got {size}. Converted to {size_dict}.\n","Image processor BeitImageProcessor {\n","  \"crop_size\": {\n","    \"height\": 224,\n","    \"width\": 224\n","  },\n","  \"do_center_crop\": false,\n","  \"do_normalize\": true,\n","  \"do_reduce_labels\": false,\n","  \"do_rescale\": true,\n","  \"do_resize\": true,\n","  \"feature_extractor_type\": \"BeitFeatureExtractor\",\n","  \"image_mean\": [\n","    0.5,\n","    0.5,\n","    0.5\n","  ],\n","  \"image_processor_type\": \"BeitImageProcessor\",\n","  \"image_std\": [\n","    0.5,\n","    0.5,\n","    0.5\n","  ],\n","  \"resample\": 3,\n","  \"rescale_factor\": 0.00392156862745098,\n","  \"size\": [\n","    640,\n","    640\n","  ]\n","}\n","\n"]}]},{"cell_type":"code","source":["# Set transforms\n","train_ds.set_transform(train_transforms)\n","test_ds.set_transform(val_transforms)"],"metadata":{"id":"TeFFVgxOpthE","executionInfo":{"status":"ok","timestamp":1672866607454,"user_tz":-210,"elapsed":6,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":105,"outputs":[]},{"cell_type":"code","source":["train_ds[10]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"3v-1pfAIh35G","executionInfo":{"status":"ok","timestamp":1672866608134,"user_tz":-210,"elapsed":686,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"b17a46cb-1622-48cd-d0b4-43355c4f83a2"},"execution_count":106,"outputs":[{"output_type":"stream","name":"stderr","text":["{param_name} should be a dictionary on of the following set of keys: {VALID_SIZE_DICT_KEYS}, got {size}. Converted to {size_dict}.\n"]},{"output_type":"execute_result","data":{"text/plain":["{'pixel_values': tensor([[[-0.7412, -0.6941, -0.7804,  ..., -0.0196, -0.0667, -0.0118],\n","          [-0.8118, -0.7490, -0.8196,  ...,  0.2235,  0.1686,  0.2235],\n","          [-0.7961, -0.7412, -0.8118,  ...,  0.5059,  0.4588,  0.4824],\n","          ...,\n","          [-0.3804, -0.3098, -0.3490,  ...,  0.6314,  0.6706,  0.6784],\n","          [-0.3490, -0.1373, -0.1686,  ...,  0.6471,  0.6706,  0.6863],\n","          [-0.4667, -0.1608, -0.1686,  ...,  0.6706,  0.6706,  0.6863]],\n"," \n","         [[-0.7804, -0.7412, -0.8353,  ..., -0.1137, -0.1686, -0.1059],\n","          [-0.8510, -0.8039, -0.8667,  ...,  0.1373,  0.0824,  0.1294],\n","          [-0.8431, -0.7961, -0.8588,  ...,  0.4275,  0.3725,  0.3961],\n","          ...,\n","          [-0.3804, -0.3255, -0.3569,  ...,  0.6000,  0.6549,  0.6706],\n","          [-0.3490, -0.1529, -0.1765,  ...,  0.6314,  0.6471,  0.6784],\n","          [-0.4745, -0.1686, -0.1765,  ...,  0.6627,  0.6471,  0.6863]],\n"," \n","         [[-0.7020, -0.6314, -0.6706,  ..., -0.2078, -0.2784, -0.2314],\n","          [-0.7725, -0.6863, -0.7098,  ...,  0.0510, -0.0275,  0.0118],\n","          [-0.7569, -0.6784, -0.6941,  ...,  0.3490,  0.2706,  0.2863],\n","          ...,\n","          [-0.3176, -0.2471, -0.2706,  ...,  0.6078,  0.6549,  0.6549],\n","          [-0.3176, -0.0980, -0.1216,  ...,  0.6235,  0.6471,  0.6627],\n","          [-0.4510, -0.1373, -0.1451,  ...,  0.6549,  0.6471,  0.6863]]]),\n"," 'labels': tensor([[0, 0, 0,  ..., 0, 0, 0],\n","         [1, 1, 1,  ..., 0, 0, 0],\n","         [1, 1, 1,  ..., 1, 0, 0],\n","         ...,\n","         [0, 0, 0,  ..., 0, 0, 0],\n","         [0, 0, 0,  ..., 0, 0, 0],\n","         [0, 0, 0,  ..., 0, 0, 0]])}"]},"metadata":{},"execution_count":106}]},{"cell_type":"code","source":["id2label = {\n","    \"0\": \"wall\",\n","    \"1\": \"building\",\n","    \"2\": \"sky\",\n","    \"3\": \"floor\",\n","    \"4\": \"tree\",\n","    \"5\": \"ceiling\",\n","    \"6\": \"road\",\n","    \"7\": \"bed \",\n","    \"8\": \"windowpane\",\n","    \"9\": \"grass\",\n","    \"10\": \"cabinet\",\n","    \"11\": \"sidewalk\",\n","    \"12\": \"person\",\n","    \"13\": \"earth\",\n","    \"14\": \"door\",\n","    \"15\": \"table\",\n","    \"16\": \"mountain\",\n","    \"17\": \"plant\",\n","    \"18\": \"curtain\",\n","    \"19\": \"chair\",\n","    \"20\": \"car\",\n","    \"21\": \"water\",\n","    \"22\": \"painting\",\n","    \"23\": \"sofa\",\n","    \"24\": \"shelf\",\n","    \"25\": \"house\",\n","    \"26\": \"sea\",\n","    \"27\": \"mirror\",\n","    \"28\": \"rug\",\n","    \"29\": \"field\",\n","    \"30\": \"armchair\",\n","    \"31\": \"seat\",\n","    \"32\": \"fence\",\n","    \"33\": \"desk\",\n","    \"34\": \"rock\",\n","    \"35\": \"wardrobe\",\n","    \"36\": \"lamp\",\n","    \"37\": \"bathtub\",\n","    \"38\": \"railing\",\n","    \"39\": \"cushion\",\n","    \"40\": \"base\",\n","    \"41\": \"box\",\n","    \"42\": \"column\",\n","    \"43\": \"signboard\",\n","    \"44\": \"chest of drawers\",\n","    \"45\": \"counter\",\n","    \"46\": \"sand\",\n","    \"47\": \"sink\",\n","    \"48\": \"skyscraper\",\n","    \"49\": \"fireplace\",\n","    \"50\": \"refrigerator\",\n","    \"51\": \"grandstand\",\n","    \"52\": \"path\",\n","    \"53\": \"stairs\",\n","    \"54\": \"runway\",\n","    \"55\": \"case\",\n","    \"56\": \"pool table\",\n","    \"57\": \"pillow\",\n","    \"58\": \"screen door\",\n","    \"59\": \"stairway\",\n","    \"60\": \"river\",\n","    \"61\": \"bridge\",\n","    \"62\": \"bookcase\",\n","    \"63\": \"blind\",\n","    \"64\": \"coffee table\",\n","    \"65\": \"toilet\",\n","    \"66\": \"flower\",\n","    \"67\": \"book\",\n","    \"68\": \"hill\",\n","    \"69\": \"bench\",\n","    \"70\": \"countertop\",\n","    \"71\": \"stove\",\n","    \"72\": \"palm\",\n","    \"73\": \"kitchen island\",\n","    \"74\": \"computer\",\n","    \"75\": \"swivel chair\",\n","    \"76\": \"boat\",\n","    \"77\": \"bar\",\n","    \"78\": \"arcade machine\",\n","    \"79\": \"hovel\",\n","    \"80\": \"bus\",\n","    \"81\": \"towel\",\n","    \"82\": \"light\",\n","    \"83\": \"truck\",\n","    \"84\": \"tower\",\n","    \"85\": \"chandelier\",\n","    \"86\": \"awning\",\n","    \"87\": \"streetlight\",\n","    \"88\": \"booth\",\n","    \"89\": \"television receiver\",\n","    \"90\": \"airplane\",\n","    \"91\": \"dirt track\",\n","    \"92\": \"apparel\",\n","    \"93\": \"pole\",\n","    \"94\": \"land\",\n","    \"95\": \"bannister\",\n","    \"96\": \"escalator\",\n","    \"97\": \"ottoman\",\n","    \"98\": \"bottle\",\n","    \"99\": \"buffet\",\n","    \"100\": \"poster\",\n","    \"101\": \"stage\",\n","    \"102\": \"van\",\n","    \"103\": \"ship\",\n","    \"104\": \"fountain\",\n","    \"105\": \"conveyer belt\",\n","    \"106\": \"canopy\",\n","    \"107\": \"washer\",\n","    \"108\": \"plaything\",\n","    \"109\": \"swimming pool\",\n","    \"110\": \"stool\",\n","    \"111\": \"barrel\",\n","    \"112\": \"basket\",\n","    \"113\": \"waterfall\",\n","    \"114\": \"tent\",\n","    \"115\": \"bag\",\n","    \"116\": \"minibike\",\n","    \"117\": \"cradle\",\n","    \"118\": \"oven\",\n","    \"119\": \"ball\",\n","    \"120\": \"food\",\n","    \"121\": \"step\",\n","    \"122\": \"tank\",\n","    \"123\": \"trade name\",\n","    \"124\": \"microwave\",\n","    \"125\": \"pot\",\n","    \"126\": \"animal\",\n","    \"127\": \"bicycle\",\n","    \"128\": \"lake\",\n","    \"129\": \"dishwasher\",\n","    \"130\": \"screen\",\n","    \"131\": \"blanket\",\n","    \"132\": \"sculpture\",\n","    \"133\": \"hood\",\n","    \"134\": \"sconce\",\n","    \"135\": \"vase\",\n","    \"136\": \"traffic light\",\n","    \"137\": \"tray\",\n","    \"138\": \"ashcan\",\n","    \"139\": \"fan\",\n","    \"140\": \"pier\",\n","    \"141\": \"crt screen\",\n","    \"142\": \"plate\",\n","    \"143\": \"monitor\",\n","    \"144\": \"bulletin board\",\n","    \"145\": \"shower\",\n","    \"146\": \"radiator\",\n","    \"147\": \"glass\",\n","    \"148\": \"clock\",\n","    \"149\": \"flag\"\n","  },\n","\n","label2id = {\n","    \"airplane\": 90,\n","    \"animal\": 126,\n","    \"apparel\": 92,\n","    \"arcade machine\": 78,\n","    \"armchair\": 30,\n","    \"ashcan\": 138,\n","    \"awning\": 86,\n","    \"bag\": 115,\n","    \"ball\": 119,\n","    \"bannister\": 95,\n","    \"bar\": 77,\n","    \"barrel\": 111,\n","    \"base\": 40,\n","    \"basket\": 112,\n","    \"bathtub\": 37,\n","    \"bed \": 7,\n","    \"bench\": 69,\n","    \"bicycle\": 127,\n","    \"blanket\": 131,\n","    \"blind\": 63,\n","    \"boat\": 76,\n","    \"book\": 67,\n","    \"bookcase\": 62,\n","    \"booth\": 88,\n","    \"bottle\": 98,\n","    \"box\": 41,\n","    \"bridge\": 61,\n","    \"buffet\": 99,\n","    \"building\": 1,\n","    \"bulletin board\": 144,\n","    \"bus\": 80,\n","    \"cabinet\": 10,\n","    \"canopy\": 106,\n","    \"car\": 20,\n","    \"case\": 55,\n","    \"ceiling\": 5,\n","    \"chair\": 19,\n","    \"chandelier\": 85,\n","    \"chest of drawers\": 44,\n","    \"clock\": 148,\n","    \"coffee table\": 64,\n","    \"column\": 42,\n","    \"computer\": 74,\n","    \"conveyer belt\": 105,\n","    \"counter\": 45,\n","    \"countertop\": 70,\n","    \"cradle\": 117,\n","    \"crt screen\": 141,\n","    \"curtain\": 18,\n","    \"cushion\": 39,\n","    \"desk\": 33,\n","    \"dirt track\": 91,\n","    \"dishwasher\": 129,\n","    \"door\": 14,\n","    \"earth\": 13,\n","    \"escalator\": 96,\n","    \"fan\": 139,\n","    \"fence\": 32,\n","    \"field\": 29,\n","    \"fireplace\": 49,\n","    \"flag\": 149,\n","    \"floor\": 3,\n","    \"flower\": 66,\n","    \"food\": 120,\n","    \"fountain\": 104,\n","    \"glass\": 147,\n","    \"grandstand\": 51,\n","    \"grass\": 9,\n","    \"hill\": 68,\n","    \"hood\": 133,\n","    \"house\": 25,\n","    \"hovel\": 79,\n","    \"kitchen island\": 73,\n","    \"lake\": 128,\n","    \"lamp\": 36,\n","    \"land\": 94,\n","    \"light\": 82,\n","    \"microwave\": 124,\n","    \"minibike\": 116,\n","    \"mirror\": 27,\n","    \"monitor\": 143,\n","    \"mountain\": 16,\n","    \"ottoman\": 97,\n","    \"oven\": 118,\n","    \"painting\": 22,\n","    \"palm\": 72,\n","    \"path\": 52,\n","    \"person\": 12,\n","    \"pier\": 140,\n","    \"pillow\": 57,\n","    \"plant\": 17,\n","    \"plate\": 142,\n","    \"plaything\": 108,\n","    \"pole\": 93,\n","    \"pool table\": 56,\n","    \"poster\": 100,\n","    \"pot\": 125,\n","    \"radiator\": 146,\n","    \"railing\": 38,\n","    \"refrigerator\": 50,\n","    \"river\": 60,\n","    \"road\": 6,\n","    \"rock\": 34,\n","    \"rug\": 28,\n","    \"runway\": 54,\n","    \"sand\": 46,\n","    \"sconce\": 134,\n","    \"screen\": 130,\n","    \"screen door\": 58,\n","    \"sculpture\": 132,\n","    \"sea\": 26,\n","    \"seat\": 31,\n","    \"shelf\": 24,\n","    \"ship\": 103,\n","    \"shower\": 145,\n","    \"sidewalk\": 11,\n","    \"signboard\": 43,\n","    \"sink\": 47,\n","    \"sky\": 2,\n","    \"skyscraper\": 48,\n","    \"sofa\": 23,\n","    \"stage\": 101,\n","    \"stairs\": 53,\n","    \"stairway\": 59,\n","    \"step\": 121,\n","    \"stool\": 110,\n","    \"stove\": 71,\n","    \"streetlight\": 87,\n","    \"swimming pool\": 109,\n","    \"swivel chair\": 75,\n","    \"table\": 15,\n","    \"tank\": 122,\n","    \"television receiver\": 89,\n","    \"tent\": 114,\n","    \"toilet\": 65,\n","    \"towel\": 81,\n","    \"tower\": 84,\n","    \"trade name\": 123,\n","    \"traffic light\": 136,\n","    \"tray\": 137,\n","    \"tree\": 4,\n","    \"truck\": 83,\n","    \"van\": 102,\n","    \"vase\": 135,\n","    \"wall\": 0,\n","    \"wardrobe\": 35,\n","    \"washer\": 107,\n","    \"water\": 21,\n","    \"waterfall\": 113,\n","    \"windowpane\": 8\n","  },\n","\n","num_labels = len(id2label)"],"metadata":{"id":"aPLA8c3KvYsx","executionInfo":{"status":"ok","timestamp":1672866608135,"user_tz":-210,"elapsed":4,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":107,"outputs":[]},{"cell_type":"code","source":["from transformers import BeitForSemanticSegmentation\n","\n","pretrained_model_name = 'microsoft/beit-base-finetuned-ade-640-640' \n","model = BeitForSemanticSegmentation.from_pretrained(\n","    pretrained_model_name,\n","    use_auth_token='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',\n","    ignore_mismatched_sizes=True,\n","    num_labels=num_labels,\n","    id2label=id2label,\n","    label2id=label2id\n",")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0IAc0bVEpxm6","executionInfo":{"status":"ok","timestamp":1672866611889,"user_tz":-210,"elapsed":3758,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"98760820-b902-489d-debd-9d50175315ba"},"execution_count":108,"outputs":[{"output_type":"stream","name":"stderr","text":["loading configuration file config.json from cache at /root/.cache/huggingface/hub/models--microsoft--beit-base-finetuned-ade-640-640/snapshots/a8b6f5ef4acb2ea55d882989deaa02d39401e2b2/config.json\n","Model config BeitConfig {\n","  \"architectures\": [\n","    \"BeitForSemanticSegmentation\"\n","  ],\n","  \"attention_probs_dropout_prob\": 0.0,\n","  \"auxiliary_channels\": 256,\n","  \"auxiliary_concat_input\": false,\n","  \"auxiliary_loss_weight\": 0.4,\n","  \"auxiliary_num_convs\": 1,\n","  \"drop_path_rate\": 0.1,\n","  \"hidden_act\": \"gelu\",\n","  \"hidden_dropout_prob\": 0.0,\n","  \"hidden_size\": 768,\n","  \"id2label\": [\n","    {\n","      \"0\": \"wall\",\n","      \"1\": \"building\",\n","      \"10\": \"cabinet\",\n","      \"100\": \"poster\",\n","      \"101\": \"stage\",\n","      \"102\": \"van\",\n","      \"103\": \"ship\",\n","      \"104\": \"fountain\",\n","      \"105\": \"conveyer belt\",\n","      \"106\": \"canopy\",\n","      \"107\": \"washer\",\n","      \"108\": \"plaything\",\n","      \"109\": \"swimming pool\",\n","      \"11\": \"sidewalk\",\n","      \"110\": \"stool\",\n","      \"111\": \"barrel\",\n","      \"112\": \"basket\",\n","      \"113\": \"waterfall\",\n","      \"114\": \"tent\",\n","      \"115\": \"bag\",\n","      \"116\": \"minibike\",\n","      \"117\": \"cradle\",\n","      \"118\": \"oven\",\n","      \"119\": \"ball\",\n","      \"12\": \"person\",\n","      \"120\": \"food\",\n","      \"121\": \"step\",\n","      \"122\": \"tank\",\n","      \"123\": \"trade name\",\n","      \"124\": \"microwave\",\n","      \"125\": \"pot\",\n","      \"126\": \"animal\",\n","      \"127\": \"bicycle\",\n","      \"128\": \"lake\",\n","      \"129\": \"dishwasher\",\n","      \"13\": \"earth\",\n","      \"130\": \"screen\",\n","      \"131\": \"blanket\",\n","      \"132\": \"sculpture\",\n","      \"133\": \"hood\",\n","      \"134\": \"sconce\",\n","      \"135\": \"vase\",\n","      \"136\": \"traffic light\",\n","      \"137\": \"tray\",\n","      \"138\": \"ashcan\",\n","      \"139\": \"fan\",\n","      \"14\": \"door\",\n","      \"140\": \"pier\",\n","      \"141\": \"crt screen\",\n","      \"142\": \"plate\",\n","      \"143\": \"monitor\",\n","      \"144\": \"bulletin board\",\n","      \"145\": \"shower\",\n","      \"146\": \"radiator\",\n","      \"147\": \"glass\",\n","      \"148\": \"clock\",\n","      \"149\": \"flag\",\n","      \"15\": \"table\",\n","      \"16\": \"mountain\",\n","      \"17\": \"plant\",\n","      \"18\": \"curtain\",\n","      \"19\": \"chair\",\n","      \"2\": \"sky\",\n","      \"20\": \"car\",\n","      \"21\": \"water\",\n","      \"22\": \"painting\",\n","      \"23\": \"sofa\",\n","      \"24\": \"shelf\",\n","      \"25\": \"house\",\n","      \"26\": \"sea\",\n","      \"27\": \"mirror\",\n","      \"28\": \"rug\",\n","      \"29\": \"field\",\n","      \"3\": \"floor\",\n","      \"30\": \"armchair\",\n","      \"31\": \"seat\",\n","      \"32\": \"fence\",\n","      \"33\": \"desk\",\n","      \"34\": \"rock\",\n","      \"35\": \"wardrobe\",\n","      \"36\": \"lamp\",\n","      \"37\": \"bathtub\",\n","      \"38\": \"railing\",\n","      \"39\": \"cushion\",\n","      \"4\": \"tree\",\n","      \"40\": \"base\",\n","      \"41\": \"box\",\n","      \"42\": \"column\",\n","      \"43\": \"signboard\",\n","      \"44\": \"chest of drawers\",\n","      \"45\": \"counter\",\n","      \"46\": \"sand\",\n","      \"47\": \"sink\",\n","      \"48\": \"skyscraper\",\n","      \"49\": \"fireplace\",\n","      \"5\": \"ceiling\",\n","      \"50\": \"refrigerator\",\n","      \"51\": \"grandstand\",\n","      \"52\": \"path\",\n","      \"53\": \"stairs\",\n","      \"54\": \"runway\",\n","      \"55\": \"case\",\n","      \"56\": \"pool table\",\n","      \"57\": \"pillow\",\n","      \"58\": \"screen door\",\n","      \"59\": \"stairway\",\n","      \"6\": \"road\",\n","      \"60\": \"river\",\n","      \"61\": \"bridge\",\n","      \"62\": \"bookcase\",\n","      \"63\": \"blind\",\n","      \"64\": \"coffee table\",\n","      \"65\": \"toilet\",\n","      \"66\": \"flower\",\n","      \"67\": \"book\",\n","      \"68\": \"hill\",\n","      \"69\": \"bench\",\n","      \"7\": \"bed \",\n","      \"70\": \"countertop\",\n","      \"71\": \"stove\",\n","      \"72\": \"palm\",\n","      \"73\": \"kitchen island\",\n","      \"74\": \"computer\",\n","      \"75\": \"swivel chair\",\n","      \"76\": \"boat\",\n","      \"77\": \"bar\",\n","      \"78\": \"arcade machine\",\n","      \"79\": \"hovel\",\n","      \"8\": \"windowpane\",\n","      \"80\": \"bus\",\n","      \"81\": \"towel\",\n","      \"82\": \"light\",\n","      \"83\": \"truck\",\n","      \"84\": \"tower\",\n","      \"85\": \"chandelier\",\n","      \"86\": \"awning\",\n","      \"87\": \"streetlight\",\n","      \"88\": \"booth\",\n","      \"89\": \"television receiver\",\n","      \"9\": \"grass\",\n","      \"90\": \"airplane\",\n","      \"91\": \"dirt track\",\n","      \"92\": \"apparel\",\n","      \"93\": \"pole\",\n","      \"94\": \"land\",\n","      \"95\": \"bannister\",\n","      \"96\": \"escalator\",\n","      \"97\": \"ottoman\",\n","      \"98\": \"bottle\",\n","      \"99\": \"buffet\"\n","    }\n","  ],\n","  \"image_size\": 640,\n","  \"initializer_range\": 0.02,\n","  \"intermediate_size\": 3072,\n","  \"label2id\": [\n","    {\n","      \"airplane\": 90,\n","      \"animal\": 126,\n","      \"apparel\": 92,\n","      \"arcade machine\": 78,\n","      \"armchair\": 30,\n","      \"ashcan\": 138,\n","      \"awning\": 86,\n","      \"bag\": 115,\n","      \"ball\": 119,\n","      \"bannister\": 95,\n","      \"bar\": 77,\n","      \"barrel\": 111,\n","      \"base\": 40,\n","      \"basket\": 112,\n","      \"bathtub\": 37,\n","      \"bed \": 7,\n","      \"bench\": 69,\n","      \"bicycle\": 127,\n","      \"blanket\": 131,\n","      \"blind\": 63,\n","      \"boat\": 76,\n","      \"book\": 67,\n","      \"bookcase\": 62,\n","      \"booth\": 88,\n","      \"bottle\": 98,\n","      \"box\": 41,\n","      \"bridge\": 61,\n","      \"buffet\": 99,\n","      \"building\": 1,\n","      \"bulletin board\": 144,\n","      \"bus\": 80,\n","      \"cabinet\": 10,\n","      \"canopy\": 106,\n","      \"car\": 20,\n","      \"case\": 55,\n","      \"ceiling\": 5,\n","      \"chair\": 19,\n","      \"chandelier\": 85,\n","      \"chest of drawers\": 44,\n","      \"clock\": 148,\n","      \"coffee table\": 64,\n","      \"column\": 42,\n","      \"computer\": 74,\n","      \"conveyer belt\": 105,\n","      \"counter\": 45,\n","      \"countertop\": 70,\n","      \"cradle\": 117,\n","      \"crt screen\": 141,\n","      \"curtain\": 18,\n","      \"cushion\": 39,\n","      \"desk\": 33,\n","      \"dirt track\": 91,\n","      \"dishwasher\": 129,\n","      \"door\": 14,\n","      \"earth\": 13,\n","      \"escalator\": 96,\n","      \"fan\": 139,\n","      \"fence\": 32,\n","      \"field\": 29,\n","      \"fireplace\": 49,\n","      \"flag\": 149,\n","      \"floor\": 3,\n","      \"flower\": 66,\n","      \"food\": 120,\n","      \"fountain\": 104,\n","      \"glass\": 147,\n","      \"grandstand\": 51,\n","      \"grass\": 9,\n","      \"hill\": 68,\n","      \"hood\": 133,\n","      \"house\": 25,\n","      \"hovel\": 79,\n","      \"kitchen island\": 73,\n","      \"lake\": 128,\n","      \"lamp\": 36,\n","      \"land\": 94,\n","      \"light\": 82,\n","      \"microwave\": 124,\n","      \"minibike\": 116,\n","      \"mirror\": 27,\n","      \"monitor\": 143,\n","      \"mountain\": 16,\n","      \"ottoman\": 97,\n","      \"oven\": 118,\n","      \"painting\": 22,\n","      \"palm\": 72,\n","      \"path\": 52,\n","      \"person\": 12,\n","      \"pier\": 140,\n","      \"pillow\": 57,\n","      \"plant\": 17,\n","      \"plate\": 142,\n","      \"plaything\": 108,\n","      \"pole\": 93,\n","      \"pool table\": 56,\n","      \"poster\": 100,\n","      \"pot\": 125,\n","      \"radiator\": 146,\n","      \"railing\": 38,\n","      \"refrigerator\": 50,\n","      \"river\": 60,\n","      \"road\": 6,\n","      \"rock\": 34,\n","      \"rug\": 28,\n","      \"runway\": 54,\n","      \"sand\": 46,\n","      \"sconce\": 134,\n","      \"screen\": 130,\n","      \"screen door\": 58,\n","      \"sculpture\": 132,\n","      \"sea\": 26,\n","      \"seat\": 31,\n","      \"shelf\": 24,\n","      \"ship\": 103,\n","      \"shower\": 145,\n","      \"sidewalk\": 11,\n","      \"signboard\": 43,\n","      \"sink\": 47,\n","      \"sky\": 2,\n","      \"skyscraper\": 48,\n","      \"sofa\": 23,\n","      \"stage\": 101,\n","      \"stairs\": 53,\n","      \"stairway\": 59,\n","      \"step\": 121,\n","      \"stool\": 110,\n","      \"stove\": 71,\n","      \"streetlight\": 87,\n","      \"swimming pool\": 109,\n","      \"swivel chair\": 75,\n","      \"table\": 15,\n","      \"tank\": 122,\n","      \"television receiver\": 89,\n","      \"tent\": 114,\n","      \"toilet\": 65,\n","      \"towel\": 81,\n","      \"tower\": 84,\n","      \"trade name\": 123,\n","      \"traffic light\": 136,\n","      \"tray\": 137,\n","      \"tree\": 4,\n","      \"truck\": 83,\n","      \"van\": 102,\n","      \"vase\": 135,\n","      \"wall\": 0,\n","      \"wardrobe\": 35,\n","      \"washer\": 107,\n","      \"water\": 21,\n","      \"waterfall\": 113,\n","      \"windowpane\": 8\n","    }\n","  ],\n","  \"layer_norm_eps\": 1e-12,\n","  \"layer_scale_init_value\": 0.1,\n","  \"model_type\": \"beit\",\n","  \"num_attention_heads\": 12,\n","  \"num_channels\": 3,\n","  \"num_hidden_layers\": 12,\n","  \"out_indices\": [\n","    3,\n","    5,\n","    7,\n","    11\n","  ],\n","  \"patch_size\": 16,\n","  \"pool_scales\": [\n","    1,\n","    2,\n","    3,\n","    6\n","  ],\n","  \"segmentation_indices\": [\n","    3,\n","    5,\n","    7,\n","    11\n","  ],\n","  \"semantic_loss_ignore_index\": 255,\n","  \"torch_dtype\": \"float32\",\n","  \"transformers_version\": \"4.25.1\",\n","  \"use_absolute_position_embeddings\": false,\n","  \"use_auxiliary_head\": true,\n","  \"use_mask_token\": false,\n","  \"use_mean_pooling\": true,\n","  \"use_relative_position_bias\": true,\n","  \"use_shared_relative_position_bias\": false,\n","  \"vocab_size\": 8192\n","}\n","\n","loading weights file pytorch_model.bin from cache at /root/.cache/huggingface/hub/models--microsoft--beit-base-finetuned-ade-640-640/snapshots/a8b6f5ef4acb2ea55d882989deaa02d39401e2b2/pytorch_model.bin\n","All model checkpoint weights were used when initializing BeitForSemanticSegmentation.\n","\n","Some weights of BeitForSemanticSegmentation were not initialized from the model checkpoint at microsoft/beit-base-finetuned-ade-640-640 and are newly initialized because the shapes did not match:\n","- decode_head.classifier.weight: found shape torch.Size([150, 768, 1, 1]) in the checkpoint and torch.Size([1, 768, 1, 1]) in the model instantiated\n","- decode_head.classifier.bias: found shape torch.Size([150]) in the checkpoint and torch.Size([1]) in the model instantiated\n","- auxiliary_head.classifier.weight: found shape torch.Size([150, 256, 1, 1]) in the checkpoint and torch.Size([1, 256, 1, 1]) in the model instantiated\n","- auxiliary_head.classifier.bias: found shape torch.Size([150]) in the checkpoint and torch.Size([1]) in the model instantiated\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n"]}]},{"cell_type":"code","source":["from transformers import TrainingArguments\n","\n","batch_size = 128\n","logging_steps = len(train_ds) // batch_size\n","\n","training_args = TrainingArguments(\n","    output_dir='./content/working/2/',\n","    per_device_train_batch_size=batch_size,\n","    per_device_eval_batch_size=batch_size,\n","    evaluation_strategy='epoch',\n","    save_strategy='epoch',\n","    num_train_epochs=1,\n","    fp16=True if torch.cuda.is_available() else False,\n","    logging_steps=logging_steps,\n","    learning_rate=1e-5,\n","    save_total_limit=2,\n","    remove_unused_columns=False,\n","    push_to_hub=False,\n","    load_best_model_at_end=True)"],"metadata":{"id":"kz39RqoKrPcY","executionInfo":{"status":"ok","timestamp":1672866611889,"user_tz":-210,"elapsed":9,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"e01c9940-331f-4cae-806c-7623297c26f5"},"execution_count":109,"outputs":[{"output_type":"stream","name":"stderr","text":["PyTorch: setting up devices\n","The default value for the training argument `--report_to` will change in v5 (from all installed integrations to none). In v5, you will need to use `--report_to all` to get the same behavior as now. You should start updating your code and make this info disappear :-).\n"]}]},{"cell_type":"code","source":["# import torch\n","# from torch import nn\n","# import evaluate\n","\n","# metric = evaluate.load(\"mean_iou\")\n","\n","# def compute_metrics(eval_pred):\n","#     with torch.no_grad():\n","#         logits, labels = eval_pred\n","#         logits_tensor = torch.from_numpy(logits)\n","#         logits_tensor = nn.functional.interpolate(\n","#             logits_tensor,\n","#             size=labels.shape[-2:],\n","#             mode=\"bilinear\",\n","#             align_corners=False,\n","#         ).argmax(dim=1)\n","\n","#         pred_labels = logits_tensor.detach().cpu().numpy()\n","#         metrics = metric.compute(\n","#             predictions=pred_labels,\n","#             references=labels,\n","#             num_labels=num_labels,\n","#             ignore_index=255,\n","#             reduce_labels=False,\n","#         )\n","#         for key, value in metrics.items():\n","#             if type(value) is np.ndarray:\n","#                 metrics[key] = value.tolist()\n","#         return metrics"],"metadata":{"id":"tABv9L49rUGI","executionInfo":{"status":"ok","timestamp":1672866611889,"user_tz":-210,"elapsed":5,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":110,"outputs":[]},{"cell_type":"code","source":["# data collator\n","def collate_fn(examples):\n","    return {\n","        'pixel_values': torch.stack([x['pixel_values'] for x in examples]),\n","        'labels': torch.stack([x['labels'] for x in examples])\n","    }\n","# metrics\n","metric = load_metric('accuracy')\n","def compute_metrics(p):\n","    labels = p.label_ids\n","    preds = p.predictions.argmax(-1)\n","    acc = accuracy_score(labels, preds)\n","    f1 = f1_score(labels, preds, average='weighted')\n","    return {\n","        'accuracy': acc,\n","        'f1': f1\n","    }"],"metadata":{"id":"Si9f8q2KjogE","executionInfo":{"status":"ok","timestamp":1672866612548,"user_tz":-210,"elapsed":664,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":111,"outputs":[]},{"cell_type":"code","source":["from transformers import Trainer\n","\n","trainer = Trainer(\n","    model=model,\n","    args=training_args,\n","    data_collator=collate_fn,\n","    train_dataset=train_ds,\n","    eval_dataset=test_ds,\n","    compute_metrics=compute_metrics,\n","    tokenizer=feature_extractor\n",")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vefUb9NsilpI","executionInfo":{"status":"ok","timestamp":1672866613243,"user_tz":-210,"elapsed":700,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}},"outputId":"0df3bd05-dfdd-4553-c78f-fc0d576a69e7"},"execution_count":112,"outputs":[{"output_type":"stream","name":"stderr","text":["Using cuda_amp half precision backend\n"]}]},{"cell_type":"code","source":["trainer.train()"],"metadata":{"id":"hSTm3s8Nrb8_"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":[],"metadata":{"id":"MoL7IOXHuBpy","executionInfo":{"status":"aborted","timestamp":1672866630737,"user_tz":-210,"elapsed":11,"user":{"displayName":"MO Na3ri","userId":"04554380363106298267"}}},"execution_count":null,"outputs":[]}]}